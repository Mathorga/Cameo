<!--This code is based on a project by Seb Lee-Delisle: http://seb.ly/2011/04/multi-touch-game-controller-in-javascripthtml5-for-ipad/-->
<!doctype html>
<html lang=en>

<head>
	<meta charset=utf-8>
	<meta name="viewport"
		content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
	<meta name="mobile-web-app-capable" content="yes">
	<title>Cameo</title>
	<style type="text/css">
		* {
			-webkit-touch-callout: none;
			/* prevent callout to copy image, etc when tap to hold */
			-webkit-text-size-adjust: none;
			/* prevent webkit from resizing text to fit */
			/* make transparent link selection, adjust last value opacity 0 to 1.0 */
			-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
			-webkit-user-select: none;
			/* prevent copy paste, to allow, change 'none' to 'text' */
			-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
		}

		body {
			background-color: #000000;
			margin: 0px;
		}

		canvas {
			display: block;
			position: absolute;
			z-index: 1;
		}

		.container {
			width: auto;
			text-align: center;
			background-color: #ff0000;
		}

		/* Headlight toggle switch (source: http://callmenick.com/post/css-toggle-switch-examples) */
		.cmn-toggle {
			position: absolute;
			margin-left: -9999px;
			visibility: hidden;
		}

		.cmn-toggle+label {
			display: block;
			position: relative;
			cursor: pointer;
			outline: none;
			user-select: none;
		}

		input.cmn-toggle-round-flat+label {
			background-color: transparent;
			border-radius: 10%;
			border: 2px;
			border-style: solid;
			border-color: white;
			text-align: center;

			padding-top: 20%;
			padding-bottom: 20%;
			font-size: 16px;
			margin: 40% 7% 10%;
			cursor: pointer;
			transition: background 0.4s;
		}

		input.cmn-toggle-round-flat:checked+label {
			background-color: gray;
		}

		.cam_button {
			background-color: transparent;
			border-radius: 100%;
			border: 7px;
			border-style: solid;
			border-color: white;
			text-align: center;

			padding-top: 40%;
			padding-bottom: 40%;
			padding-left: 40%;
			padding-right: 40%;
			font-size: 16px;
			margin: 50% 3% 4% 4%;
			cursor: pointer;
		}

		.cam_button:active {
			background-color: gray;
		}

		.off_button {
			background-color: transparent;
			border-radius: 10%;
			border: 2px;
			border-style: solid;
			border-color: white;
			text-align: center;

			padding-top: 20%;
			padding-bottom: 20%;
			font-size: 100%;
			margin: 10% 7%;
			cursor: pointer;
		}

		.off_button:active {
			background-color: gray;
		}

		.light_button {
			background-color: transparent;
			border-radius: 10%;
			border: 2px;
			border-style: solid;
			border-color: white;
			text-align: center;

			padding-top: 20%;
			padding-bottom: 20%;
			font-size: 16px;
			margin: 40% 7% 10%;
			cursor: pointer;
		}

		.light_button:checked {
			background-color: #b1b;
		}

		.sidenav {
			color: #fff;
			height: 100%;
			width: 13%;
			position: fixed;
			z-index: 0;
			top: 0px;
			background-color: #111;
			overflow-x: hidden;
			padding-top: 20px;
			font-family: 'Roboto', sans-serif;
		}







		p#stream {
			position: relative;
			top: -15px;
		}
	</style>
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

</head>
<ul id="messages"></ul>
<script src="/socket.io/socket.io.js"></script>
<script>
	var temperature;
	var socket = io(); // comment this out for better debugging

	setInterval(draw, 1000 / 30); // draw app at 30fps

	function draw() {
		socket.on(
			"temp",
			function (msg) {
				document.getElementById("temp").innerHTML = parseInt(msg) + "°C";
				temperature = msg;
			}
		);

		socket.on(
			"cam",
			function (msg) {
				document.getElementById("stream").innerHTML = img;
			}
		);
	}

</script>

<body scroll="no" style="overflow: hidden">
	<center>

		<p id="stream"></p>

		<script>
			// This script automatically picks the right IP for the stream 
			// Thanks to wonx (github.com/wonx)
			host = window.location.hostname;
			img = "<img src=\"http://" + host + ":9000/?action=stream\" style=\"height:100vh;\"/>";
			//img = '<img src="stream.png" style="height:100vh;"/>';
			document.getElementById("stream").innerHTML = img;
			function takePicture() {
				socket.emit("cam", 1);
			}
			function shutdown() {
				if (confirm("This will shutdown the Pi.\nAre you sure?")) {
					alert("Shutting down...\nPlease wait 20s before turning the power off.");
					socket.emit("power", 1);
				}
			}
			// Handle headlight button
			function handleHeadlightClick(cb) {
				if (cb.checked) {
					// Turn on headlight
					headlight = 1;
				} else {
					// Turn off headlight
					headlight = 0;
				}
				socket.emit("light", headlight);
			}

		</script>

	</center>

	<!-- Left sidenav. -->
	<div class="sidenav">
		<center id="temp" style="padding:40%;">0°C</center>
	</div>

	<!-- Right sidenav -->
	<div class="sidenav" style="right:0;z-index: 2;">
		<!-- Shutdown button. -->
		<!-- <center class="off_button" type="button" onclick="shutdown()">OFF</center> -->

		<!-- Shutter button. -->
		<center class="cam_button" type="button" onclick="takePicture()"></center>

		<!-- Flashlight button. -->
		<!-- <div>
			<div class="switch">
				<input id="cmn-toggle"css class="cmn-toggle cmn-toggle-round-flat" type="checkbox" onclick="handleHeadlightClick(this)">
				<label for="cmn-toggle">LIGHT</label>
			</div>
		</div> -->
	</div>
</body>

</html>